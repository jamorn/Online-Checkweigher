/* Custom styles extracted from Online-Checkweigher-Simulation.html */
:root{
    --bg-body: #0f172a;
}
body{
    background-color: var(--bg-body);
    color: #f8fafc;
    margin:0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
.shadow-canvas{
    background: #1e293b;
    border: 4px solid #334155;
    border-radius: 15px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    max-width: 95vw;
}
.display-panel{
    background: #1e293b;
    border-left: 5px solid #3b82f6;
    padding: 20px;
    border-radius: 10px;
    width: 950px; /* match factoryCanvas width */
    display: flex;
    justify-content: space-around;
    align-items: center;
    margin-top: 20px;
    margin-left: 0; /* align left within the left column */
}

/* Wrapper around canvas + display to keep overlays constrained to canvas width */
.machine-wrap{
    width: 950px;
    margin: 0 auto;
    position: relative;
}
/* If a hopper preview is placed before the order panel, keep the panel in the document flow
   so it doesn't overlap the preview. The selector targets the order-panel immediately
   following a .hopper-preview inside .machine-wrap. */
.machine-wrap > .hopper-preview + .order-panel,
.machine-wrap > .hopper-preview + .order-panel.order-panel-anchored {
    position: relative !important;
    top: auto !important;
    left: auto !important;
    right: auto !important;
    margin-top: 8px;
    z-index: 20;
}

/* Ensure Machine B's order panel remains anchored/absolute (restore original behavior) */
#orderPanel2.order-panel-anchored {
    position: absolute !important;
    top: 1rem !important;
    right: 12px !important;
    left: auto !important;
    z-index: 20 !important;
}

/* When a package is a special size (25 or 750), show Machine B's order panel
   in the top-left corner of its machine area for emphasis. */
#orderPanel2.order-panel-anchored.top-left-package {
    left: 12px !important;
    right: auto !important;
    top: 1rem !important;
    width: 380px !important;
    max-width: calc(100% - 24px) !important;
    z-index: 30 !important;
    transform: none !important;
}

@media (max-width: 1100px) {
    /* revert to in-flow on narrower layouts to avoid overlap */
    #orderPanel2.order-panel-anchored.top-left-package {
        position: relative !important;
        top: auto !important;
        left: auto !important;
        right: auto !important;
        width: 100% !important;
        margin: 6px 0 !important;
        z-index: 10 !important;
    }
}

/* Machine A order panel restored. */

#orderPanel.order-panel-anchored {
    position: absolute !important;
    /* place under the preview (preview height + small gap) */
    top: calc(var(--hopper-preview-h) + 12px) !important;
    right: 12px !important;
    left: auto !important;
    z-index: 25 !important;
    /* extend width toward the left while keeping right edge fixed */
    width: calc(100% - 160px) !important; /* leave ~160px space on the right */
    max-width: none !important;
}

@media (max-width: 980px) {
    .machine-wrap > .hopper-preview { --hopper-preview-h: 180px; }
    #orderPanel.order-panel-anchored { top: calc(var(--hopper-preview-h) + 8px) !important; width: calc(100% - 48px) !important; }
}

/* Desktop: allow order-panel to be wider so meta doesn't wrap */
@media (min-width: 981px) {
    /* Apply same anchored sizing to both machine order panels */
    .order-panel.order-panel-anchored {
        max-width: calc(100% - 48px) !important;
        padding-right: 20px !important;
    }
    /* keep meta on one line if space allows */
    .order-panel.order-panel-anchored #orderMeta,
    .order-panel.order-panel-anchored #orderMeta2 {
        /* Allow the meta block to wrap on desktop so full details are visible.
           Keep an upper max-width to preserve layout with produced/progress columns. */
        white-space: normal !important;
        overflow-wrap: anywhere !important;
        overflow: visible !important;
        text-overflow: clip !important;
        max-width: calc(100% - 140px) !important; /* slightly more room for meta text */
    }
}
/* Keep the logical preview height smaller so the order panel stays in its intended place
    while allowing the iframe itself to be taller to avoid internal scrollbars. */
.machine-wrap > .hopper-preview { --hopper-preview-h: 220px; }

/* Hopper preview iframe styles */
.hopper-preview{ width:100%; max-width:950px; margin: 0 auto 12px; }
.hopper-preview .preview-header{ color: #94a3b8; }
.hopper-iframe{ width:100%; height:720px; border:8px solid #334155; border-radius:12px; display:block; box-shadow: 0 10px 30px rgba(0,0,0,0.5); background:#0b1220; }
@media (max-width: 980px){ .hopper-iframe{ height:640px; } .hopper-preview{ max-width:95% !important; } }
.status-pill{
    padding: 5px 15px;
    border-radius: 20px;
    font-weight: bold;
    text-transform: uppercase;
}

/* Utility for canvas size on smaller screens */
@media (max-width: 1024px){
    .display-panel{ width: 95%; }
}

@media (max-width: 980px){
    .machine-wrap, .display-panel, .shadow-canvas { width: 95% !important; }
    .order-panel { left:4% !important; right:4% !important; width:auto !important; transform:none !important; }
}

/* Ensure order-panel becomes non-overlapping earlier on narrower layouts
   Force it into flow so it pushes layout instead of sitting on top of the aside feed. */
@media (max-width: 1100px) {
    .order-panel {
        position: relative !important;
        top: auto !important;
        left: auto !important;
        right: auto !important;
        width: 100% !important;
        max-width: 100% !important;
        margin: 6px 0 12px 0 !important;
        transform: none !important;
        z-index: 10 !important;
    }
    /* hide progress and produced count on narrower layouts to save horizontal space */
    .order-panel .w-40, .order-panel .order-right { display: none !important; }
}

/* Fix for iPad / small tablets: prevent order-panel overflow and make display-panel box-size friendly */
@media (max-width: 820px) {
    .machine-wrap, .display-panel, .shadow-canvas {
        width: calc(100% - 32px) !important;
        margin-left: 16px;
        margin-right: 16px;
        box-sizing: border-box;
    }

    /* Put order panel into document flow on small screens to avoid overflow */
    .order-panel {
        position: relative !important;
        top: auto !important;
        right: auto !important;
        left: auto !important;
        margin: 8px 0 12px 0 !important;
        width: 100% !important;
        max-width: 100% !important;
        transform: none !important;
    }

    /* Reduce display-panel padding so it fits better */
    .display-panel {
        padding: 12px !important;
        width: calc(100% - 0px) !important;
    }

    /* Ensure order meta wraps and doesn't overflow */
    .order-panel #orderMeta{
        white-space: normal !important;
        overflow-wrap: anywhere !important;
        max-width: 100% !important;
    }
}

/* Tooltip for metal detector */
#detectorTooltip{
    position: absolute;
    background: rgba(15,23,42,0.95);
    color: #f1f5f9;
    border: 1px solid rgba(148,163,184,0.1);
    padding: 8px 10px;
    font-size: 13px;
    border-radius: 6px;
    box-shadow: 0 6px 20px rgba(2,6,23,0.6);
    pointer-events: none;
    z-index: 60;
}

.hidden { display: none; }

/* Feed header underline and spacing */
.feed-header{
    display: grid;
    grid-template-columns: 1fr 1fr 0.9fr 1fr;
    gap: 8px;
    align-items: center;
    border-bottom: 1px solid rgba(148,163,184,0.06);
    padding: 6px 8px 8px 8px;
    font-size: 12px;
    color: #94a3b8;
}
.feed-item{ background: rgba(30,41,59,0.55); }

/* Live-feed styles (match trade-feed demo) */
.feed-container { position: relative; }
.feed-list {
    display: flex;
    flex-direction: column;
    position: relative;
    width: 100%;
    overflow-y: auto;
    padding-right: 12px; /* fallback spacing when scrollbars are visible */
    box-sizing: border-box;
    -ms-overflow-style: none; /* hide scrollbar in IE/Edge */
}

@supports (scrollbar-width: none) {
    .feed-list { scrollbar-width: none; } /* Firefox */
}

/* WebKit/Blink fallback */
.feed-list::-webkit-scrollbar { width: 0; height: 0; }
.feed-item {
    display: grid;
    grid-template-columns: 1fr 1fr 0.9fr 1fr;
    gap: 8px;
    align-items: center;
    padding: 10px 12px;
    border-radius: 6px;
    border: 1px solid rgba(52,64,84,0.35);
    background: linear-gradient(180deg, rgba(30,41,59,0.6), rgba(18,28,40,0.5));
    transform: translateY(0);
    opacity: 1;
    height: 48px;
    box-sizing: border-box;
    will-change: opacity, transform;
}

.feed-item.show { opacity: 1; }

.feed-item.pass { border-left: 4px solid #16a34a; }
.feed-item.reject { border-left: 4px solid #ef4444; }
.feed-item .time { color: #94a3b8; font-size: 12px; }
.feed-item .weight { text-align: right; font-family: monospace; }
.feed-item .metal { text-align: center; font-size: 12px; color: #cbd5e1; }
.feed-item .status { text-align: right; font-size: 12px; color: #cbd5e1; }

/* value colour states */
.feed-item .weight.val-normal, .feed-item .status.val-normal { color: #16a34a; }
.feed-item .weight.val-warn,  .feed-item .status.val-warn  { color: #f59e0b; }
.feed-item .weight.val-reject, .feed-item .status.val-reject { color: #ef4444; }

/* Metal type colours */
.metal-ferrous { color: #ef4444; font-weight: 600; }
.metal-nonferrous { color: #f59e0b; font-weight: 600; }
.metal-stainless { color: #3b82f6; font-weight: 600; }
.metal-ok { color: #16a34a; font-weight: 600; }

/* Make selectors more specific so they override the generic .feed-item .metal rule */
.feed-item .metal.metal-ferrous { color: #ef4444; font-weight: 600; }
.feed-item .metal.metal-nonferrous { color: #f59e0b; font-weight: 600; }
.feed-item .metal.metal-stainless { color: #3b82f6; font-weight: 600; }
.feed-item .metal.metal-ok { color: #16a34a; font-weight: 600; }

.feed-header .text-right { text-align: right; }

/* Order panel overlay (top-right) */
.order-panel{ -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px); }
.order-panel #orderType{ font-size:14px; }
.order-panel .font-mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, 'Roboto Mono', 'Courier New', monospace; }
.order-panel .progress-bar{ height:8px; background: rgba(255,255,255,0.06); border-radius:6px; overflow:hidden; }
.order-panel .progress-bar > i{ display:block; height:100%; background: linear-gradient(90deg,#10b981,#06b6d4); width:0%; }
/* prevent long meta text from wrapping the bar */
.order-panel #orderMeta { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 900px; }
/* slightly reduce progress-bar height for tighter fit */
.progress-bar{ height:6px; }
.progress-bar > i{ height:100%; }
/* Horizontal order panel tweaks */
.order-panel{ min-width: 320px; }
.order-panel .text-sm{ line-height:1; }
.order-panel .font-mono{ font-size:13px; }

/* order panel sizing and shadow — restored to default appearance */
.order-panel{ border:1px solid rgba(148,163,184,0.08); box-shadow: 0 6px 20px rgba(2,6,23,0.45); width: auto; max-width: calc(100% - 220px); }

/* Extracted inline rules from index.html */
.order-panel-anchored { right: 12px; left: auto; max-width: calc(100% - 220px); width: auto; }

/* Progress fill initial state (moved from inline) */
#progressBarFill, #progressBarFill2 { width: 0%; }

/* Visual emphasis for the active order panel to match Machine A focus */
.order-panel.active{ border-color: rgba(96,165,250,0.28); box-shadow: 0 14px 40px rgba(2,6,23,0.6); }
/* Ensure highlighted panel text matches visual emphasis (white values) */
.order-panel.active #orderType { color: #ffffff !important; }
.order-panel.active #orderType2 { color: #ffffff !important; }
.order-panel.active .order-val { color: #ffffff !important; }

/* layout adjustments for order panel */
/* tighten spacing */
.order-panel { gap: 8px; }
.order-panel .left-group{ flex: 0 1 auto; min-width: 96px; display:flex; align-items:center; gap:6px; }
.order-panel #orderMeta{ max-width: 420px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
/* Progress/prod shown on desktop; hide on narrow screens (moved into responsive rules below) */
/* Allow the order meta to wrap and use available space when progress/produced are hidden */
.order-panel #orderMeta{
    white-space: normal !important;
    overflow-wrap: anywhere;
    max-width: calc(100% - 24px) !important;
    text-overflow: clip;
}
/* Order meta key/value styling (Option A): subtle key, prominent value */
.order-panel #orderMeta .order-key{ color: #94a3b8; font-size:11px; text-transform:uppercase; margin-right:4px; }
.order-panel #orderMeta .order-val{ color: #ffffff; font-weight:700; margin-right:8px; }
.order-panel #orderMeta .order-sep{ color: #94a3b8; margin:0 6px; }
/* make progress bar longer to the left and reduce produced width */
.order-panel .w-40 { width: 96px; flex: 0 0 96px; }
.order-panel .order-right { flex: 0 0 48px; }

@media (max-width: 900px){
    #orderPanel{ left:8px; right:8px; }
}

/* Tweak Machine B feed vertical alignment to better match canvas position */
/* remove forced offset so feed columns align vertically with machine canvas */
#bagFeed2 { margin-top: 0; }

/* Mobile: control visibility of desktop-only order panel pieces and expanded state */
@media (max-width: 767.98px) {
    .order-panel .mobile-hidden { display: none !important; }
    .order-panel.expanded-mobile .mobile-hidden { display: flex !important; }
    .order-panel.expanded-mobile { max-width: 96% !important; }
    /* small expand button styling */
    .order-panel button#orderExpandBtn,
    .order-panel button#orderExpandBtn2 { background: transparent; border: none; color: #cbd5e1; padding: 4px 6px; border-radius: 4px; }
}

/* Small phones: compact layout tweaks to fit narrow viewports (e.g. Pixel 7) */
@media (max-width: 480px) {
    .machine-wrap, .display-panel, .shadow-canvas {
        width: 100% !important;
        max-width: 100% !important;
        margin-left: 0 !important;
        margin-right: 0 !important;
        box-sizing: border-box;
    }

    .shadow-canvas {
        border-radius: 10px !important;
        border-width: 3px !important;
        max-height: 220px !important;
        height: auto !important;
    }

    /* Make the big display more compact */
    .display-panel {
        padding: 10px !important;
        width: 100% !important;
        font-size: 13px !important;
    }
    .display-panel p.text-4xl { font-size: 28px !important; }

    /* Compact the order panel so it doesn't push content */
    .order-panel {
        position: relative !important;
        margin: 6px 0 !important;
        padding: 6px 8px !important;
        gap: 6px !important;
        min-width: 0 !important;
        max-width: 100% !important;
    }
    .order-panel .left-group { gap: 6px !important; }
    .order-panel #orderType, .order-panel #orderType2 { font-size: 12px !important; }
    .order-panel #orderMeta, .order-panel #orderMeta2 { font-size: 12px !important; }

    /* Tweak mobile expand button */
    .order-panel button#orderExpandBtn, .order-panel button#orderExpandBtn2 {
        padding: 4px 6px !important;
        font-size: 12px !important;
        line-height: 1 !important;
    }

    /* Feed container and items slightly smaller */
    .feed-container { padding: 8px !important; }
    .feed-item { height: 44px !important; padding: 8px !important; font-size: 12px !important; }

    /* Ensure orderMeta wraps nicely */
    .order-panel #orderMeta{ white-space: normal !important; overflow-wrap: anywhere !important; }
}

/* Landscape / short-height devices (e.g. Pixel 7 landscape) — avoid order-panel overlapping canvas */
@media (orientation: landscape) and (max-width: 900px), (max-height: 520px) {
    .order-panel {
        position: relative !important;
        top: auto !important;
        left: auto !important;
        right: auto !important;
        margin: 6px 0 10px 0 !important;
        width: calc(100% - 16px) !important;
        max-width: 100% !important;
        transform: none !important;
    }
    /* Make sure the canvas/display stack below the panel with proper spacing */
    .machine-wrap .shadow-canvas, .machine-wrap canvas { margin-top: 6px !important; }
}

/* Safety cap: prevent order-panel growing too wide on medium/narrow layouts */
@media (max-width: 960px) {
    .order-panel {
        position: relative !important;
        left: auto !important;
        right: auto !important;
        width: auto !important;
        max-width: 420px !important;
        margin-right: 12px !important;
        margin-left: 12px !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
        white-space: nowrap; /* keep single-line title but allow meta to wrap via specific rule */
    }
    .order-panel #orderMeta { white-space: normal !important; overflow-wrap: anywhere !important; }
}

/* Extra compression for very short landscape (Pixel7) */
@media (orientation: landscape) and (max-width: 820px) {
    .order-panel { padding: 4px 6px !important; gap: 6px !important; }
    .order-panel #orderType, .order-panel #orderType2 { font-size: 11px !important; }
    .order-panel #orderMeta, .order-panel #orderMeta2 { font-size: 11px !important; }
    .display-panel { padding: 8px !important; font-size: 12px !important; }
    .display-panel p.text-4xl { font-size: 22px !important; }
    .shadow-canvas { max-height: 160px !important; }
    .machine-wrap canvas { max-height: 160px !important; height: auto !important; }
    .feed-container { padding: 6px !important; }
}



/* Stack order-panel and its children vertically in landscape/short-height to prevent overlap */
@media (orientation: landscape) and (max-width: 900px), (max-height: 520px) {
    .order-panel { display: flex !important; flex-direction: column !important; align-items: stretch !important; }
    .order-panel .left-group { display: flex !important; flex-direction: column !important; gap: 6px !important; align-items: flex-start !important; }
    .order-panel .left-group .order-key { font-size: 10px !important; }
    .order-panel .left-group .order-val { font-size: 13px !important; }
    /* hide side elements that are not useful in stacked mode */
    .order-panel .order-right, .order-panel .w-40 { display: none !important; }

    /* Make display panel also stack vertically (like portrait) */
    .display-panel { display: flex !important; flex-direction: column !important; align-items: stretch !important; }
    .display-panel .text-center { width: 100% !important; }
    .display-panel input[type="range"] { width: 100% !important; }
}

/* Make display-panel stack vertically on very small screens to prevent Settings overflowing */
@media (max-width: 480px) {
    .display-panel {
        display: flex !important;
        flex-direction: column !important;
        align-items: stretch !important;
        gap: 8px !important;
    }
    /* Only make non-separator children full-width; hide thin vertical separators (w-px) on mobile */
    .display-panel > div:not(.w-px) { width: 100% !important; }
    .display-panel > .w-px { display: none !important; }
    /* make range control full width so the thumb doesn't run off-screen */
    .display-panel input[type="range"] { width: 100% !important; }
    /* center small labels but keep layout stacked */
    .display-panel .text-center { text-align: center !important; }
}

/* iOS / Mobile Safari specific tweaks (feature-detect for -webkit-overflow-scrolling) */
@supports (-webkit-overflow-scrolling: touch) {
    /* Respect safe-area insets for devices with notches */
    .machine-wrap { padding-left: env(safe-area-inset-left, 0px); padding-right: env(safe-area-inset-right, 0px); }

    /* Force order panel into flow on iOS earlier and make it touch-friendly */
    @media (max-width: 1100px) {
        .order-panel {
            position: relative !important;
            width: calc(100% - 28px) !important;
            max-width: calc(100% - 28px) !important;
            margin: 10px auto !important;
            padding: 8px 10px !important;
            transform: none !important;
            z-index: 20 !important;
            touch-action: manipulation;
        }
    }

    /* Tighter landscape caps for iOS to avoid vertical clipping */
    @media (orientation: landscape) and (max-width: 900px), (max-height: 520px) {
        .shadow-canvas { max-height: 190px !important; }
        .machine-wrap canvas { max-height: 190px !important; height: auto !important; }
        .display-panel { margin-top: 8px !important; }
        .feed-list { max-height: 220px !important; }
    }

    /* Reduce heavy shadows and borders on iOS to improve performance and readability */
    .order-panel, .shadow-canvas { box-shadow: 0 8px 24px rgba(2,6,23,0.45) !important; }
}



